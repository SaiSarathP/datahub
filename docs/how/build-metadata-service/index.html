<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="search" type="application/opensearchdescription+xml" title="DataHub" href="/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600&display=swap"><title data-react-helmet="true">Metadata Service Developer Guide | DataHub</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://datahubproject.io/docs/how/build-metadata-service"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Metadata Service Developer Guide | DataHub"><meta data-react-helmet="true" name="description" content="This guide assumes that you are already familar with the architecture of DataHub&#x27;s Metadata Serving Layer, as described here."><meta data-react-helmet="true" property="og:description" content="This guide assumes that you are already familar with the architecture of DataHub&#x27;s Metadata Serving Layer, as described here."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://datahubproject.io/docs/how/build-metadata-service"><link data-react-helmet="true" rel="alternate" href="https://datahubproject.io/docs/how/build-metadata-service" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://datahubproject.io/docs/how/build-metadata-service" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.50b661b8.css">
<link rel="preload" href="/assets/js/runtime~main.9cd1f951.js" as="script">
<link rel="preload" href="/assets/js/main.0198f1b5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#090a11;color:#ffffff" role="banner"><div class="announcementBarContent_3EUC"><div><img src="/img/acryl-logo-white-mark.svg"><p><strong>Managed DataHub</strong><span> &nbsp;Acryl Data delivers an easy to consume DataHub platform for the enterprise</span></p></div> <a href="https://www.acryldata.io/datahub-beta" target="_blank" class="button button--primary">Sign up for Managed DataHub →</a></div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/datahub-logo-color-light-horizontal.svg" alt="DataHub Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/datahub-logo-color-dark-horizontal.svg" alt="DataHub Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/docs/demo">Demo</a><a href="https://blog.datahubproject.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://feature-requests.datahubproject.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Feature Requests<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a class="navbar__item navbar__link" href="/docs/roadmap">Roadmap</a><a href="https://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link item__icon item__slack" aria-label="Slack"></a><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link item__icon item__github" aria-label="GitHub"></a><a href="https://www.youtube.com/channel/UC3qFQC5IiwR5fvWEqi_tJ5w" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link item__icon item__youtube" aria-label="YouTube"></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE" style="background-image:url(&quot;data:image/svg+xml,%3Csvg width=&#x27;18&#x27; height=&#x27;18&#x27; fill=&#x27;none&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Cpath d=&#x27;M15.556 9.784A6.065 6.065 0 0 1 14 9.987a5.948 5.948 0 0 1-4.235-1.752 6.02 6.02 0 0 1-1.548-5.792.75.75 0 0 0-.918-.917A7.51 7.51 0 0 0 3.93 3.462c-2.924 2.924-2.924 7.682 0 10.607a7.453 7.453 0 0 0 5.304 2.198c2.003 0 3.886-.78 5.302-2.197a7.505 7.505 0 0 0 1.937-3.368.75.75 0 0 0-.918-.918Zm-2.079 3.225a5.96 5.96 0 0 1-4.242 1.758 5.964 5.964 0 0 1-4.243-1.758 6.009 6.009 0 0 1 0-8.486 5.942 5.942 0 0 1 1.545-1.112 7.52 7.52 0 0 0 2.167 5.886 7.479 7.479 0 0 0 5.886 2.168 6.026 6.026 0 0 1-1.113 1.544Z&#x27; fill=&#x27;%23fff&#x27; opacity=&#x27;.5&#x27;/%3E%3C/svg%3E&quot;);width:18px;height:18px;margin:-4px 0 0 -4px"> </span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE" style="background-image:url(&quot;data:image/svg+xml,%3Csvg width=&#x27;18&#x27; height=&#x27;18&#x27; fill=&#x27;none&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27;%3E%3Cg opacity=&#x27;.5&#x27; fill=&#x27;%23fff&#x27;%3E%3Cpath d=&#x27;M5.245 9A3.76 3.76 0 0 0 9 12.755 3.76 3.76 0 0 0 12.755 9 3.76 3.76 0 0 0 9 5.245 3.76 3.76 0 0 0 5.245 9ZM9 6.745A2.258 2.258 0 0 1 11.255 9 2.258 2.258 0 0 1 9 11.255 2.258 2.258 0 0 1 6.745 9 2.258 2.258 0 0 1 9 6.745Zm-.752 7.505h1.5v2.25h-1.5v-2.25Zm0-12.75h1.5v2.25h-1.5V1.5Zm-6.75 6.75h2.25v1.5h-2.25v-1.5Zm12.75 0h2.25v1.5h-2.25v-1.5ZM3.164 13.773l1.59-1.592 1.062 1.06-1.59 1.592-1.062-1.06ZM12.18 4.758l1.592-1.592 1.06 1.06-1.591 1.592-1.06-1.06ZM4.756 5.819l-1.59-1.592 1.06-1.06L5.818 4.76l-1.06 1.06ZM14.832 13.773l-1.06 1.06-1.592-1.591 1.06-1.06 1.592 1.59Z&#x27;/%3E%3C/g%3E%3C/svg%3E&quot;);width:18px;height:18px;margin:-4px 0 0 -4px"> </span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Metadata Service Developer Guide</h1></header><p>This guide assumes that you are already familar with the architecture of DataHub&#x27;s Metadata Serving Layer, as described <a href="/docs/architecture/metadata-serving">here</a>. </p><p>Read on to understand how to build and extend the DataHub service tier for your specific needs.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="using-daos-to-store-and-query-metadata">Using DAOs to store and query Metadata<a aria-hidden="true" class="hash-link" href="#using-daos-to-store-and-query-metadata" title="Direct link to heading">​</a></h2><p>DataHub metadata service uses the excellent <code>datahub-gma</code> library to store and query metadata in a standard way.
There are four types of Data Access Objects (<a href="https://en.wikipedia.org/wiki/Data_access_object" target="_blank" rel="noopener noreferrer">DAO</a>) that standardize the way metadata is accessed.
This section describes each type of DAO, its purpose, and the interface. </p><p>These DAOs rely heavily on <a href="https://docs.oracle.com/javase/tutorial/extra/generics/index.html" target="_blank" rel="noopener noreferrer">Java Generics</a> so that the core logics can remain type-neutral.
However, as there’s no inheritance in <a href="https://linkedin.github.io/rest.li/pdl_schema" target="_blank" rel="noopener noreferrer">Pegasus</a>, the generics often fallback to extending <a href="https://github.com/linkedin/rest.li/blob/master/data/src/main/java/com/linkedin/data/template/RecordTemplate.java" target="_blank" rel="noopener noreferrer">RecordTemplate</a> instead of the desired types (i.e. <a href="/docs/what/entity">entity</a>, <a href="/docs/what/relationship">relationship</a>, metadata <a href="/docs/what/aspect">aspect</a> etc). Additional runtime type checking has been added to the DAOs to avoid binding to unexpected types. We also cache the type checking result to minimize runtime overhead.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="key-value-dao-local-dao">Key-value DAO (Local DAO)<a aria-hidden="true" class="hash-link" href="#key-value-dao-local-dao" title="Direct link to heading">​</a></h3><p><a href="/docs/what/gms">GMS</a> use <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/BaseLocalDAO.java" target="_blank" rel="noopener noreferrer">Local DAO</a> to store and retrieve metadata <a href="/docs/what/aspect">aspect</a>s from the local document store.
Below shows the base class and its simple key-value interface.
As the DAO is a generic class, it needs to be bound to specific type during instantiation.
Each entity type will need to instantiate its own version of DAO.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class BaseLocalDAO&lt;ASPECT extends UnionTemplate&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;URN extends Urn, METADATA extends RecordTemplate&gt; void </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  add(Class&lt;METADATA&gt; type, URN urn, METADATA value);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;URN extends Urn, METADATA extends RecordTemplate&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Optional&lt;METADATA&gt; get(Class&lt;METADATA&gt; type, URN urn, int version);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;URN extends Urn, METADATA extends RecordTemplate&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ListResult&lt;Integer&gt; listVersions(Class&lt;METADATA&gt; type, URN urn, int start, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int pageSize);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;METADATA extends RecordTemplate&gt; ListResult&lt;Urn&gt; listUrns( </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Class&lt;METADATA&gt; type, int start, int pageSize);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;URN extends Urn, METADATA extends RecordTemplate&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ListResult&lt;METADATA&gt; list(Class&lt;METADATA&gt; type, URN urn, int start, int pageSize);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Another important function of <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/BaseLocalDAO.java" target="_blank" rel="noopener noreferrer">Local DAO</a> is to automatically emit <a href="/docs/what/mxe#metadata-audit-event-mae">MAE</a>s whenever the metadata is updated.
This is doable because MAE effectively use the same <a href="https://linkedin.github.io/rest.li/pdl_schema" target="_blank" rel="noopener noreferrer">Pegasus</a> models so <a href="https://github.com/linkedin/rest.li/blob/master/data/src/main/java/com/linkedin/data/template/RecordTemplate.java" target="_blank" rel="noopener noreferrer">RecordTemplate</a> can be easily converted into the corresponding <a href="https://github.com/apache/avro/blob/master/lang/java/avro/src/main/java/org/apache/avro/generic/GenericRecord.java" target="_blank" rel="noopener noreferrer">GenericRecord</a>.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="search-dao">Search DAO<a aria-hidden="true" class="hash-link" href="#search-dao" title="Direct link to heading">​</a></h3><p>Search DAO is also a generic class that can be bound to a specific type of search document.
The DAO provides 3 APIs:</p><ul><li>A <code>search</code> API that takes the search input, a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/Filter.pdl" target="_blank" rel="noopener noreferrer">Filter</a>, a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/SortCriterion.pdl" target="_blank" rel="noopener noreferrer">SortCriterion</a>, some pagination parameters, and returns a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/SearchResult.java" target="_blank" rel="noopener noreferrer">SearchResult</a>. </li><li>An <code>autoComplete</code> API which allows typeahead-style autocomplete based on the current input and a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/Filter.pdl" target="_blank" rel="noopener noreferrer">Filter</a>, and returns <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/AutoCompleteResult.pdl" target="_blank" rel="noopener noreferrer">AutocompleteResult</a>.</li><li>A <code>filter</code> API which allows for filtering only without a search input. It takes a a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/Filter.pdl" target="_blank" rel="noopener noreferrer">Filter</a> and a <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/pegasus/com/linkedin/metadata/query/SortCriterion.pdl" target="_blank" rel="noopener noreferrer">SortCriterion</a> as input and returns <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/SearchResult.java" target="_blank" rel="noopener noreferrer">SearchResult</a>.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class BaseSearchDAO&lt;DOCUMENT extends RecordTemplate&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public abstract SearchResult&lt;DOCUMENT&gt; search(String input, Filter filter, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        SortCriterion sortCriterion, int from, int size);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public abstract AutoCompleteResult autoComplete(String input, String field,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Filter filter, int limit);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  public abstract SearchResult&lt;DOCUMENT&gt; filter(Filter filter, SortCriterion sortCriterion, </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        int from, int size);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="query-dao">Query DAO<a aria-hidden="true" class="hash-link" href="#query-dao" title="Direct link to heading">​</a></h3><p>Query DAO allows clients, e.g. <a href="/docs/what/gms">GMS</a>, <a href="/docs/architecture/metadata-serving#metadata-index-applier-mae-consumer-job">MAE Consumer Job</a> etc, to perform both graph &amp; non-graph queries against the metadata graph.
For instance, a GMS can use the Query DAO to find out “all the dataset owned by the users who is part of the group <code>foo</code> and report to <code>bar</code>,” which naturally translates to a graph query.
Alternatively, a client may wish to retrieve “all the datasets that stored under /jobs/metrics”, which doesn’t involve any graph traversal.</p><p>Below is the base class for Query DAOs, which contains the <code>findEntities</code> and <code>findRelationships</code> methods.
Both methods also have two versions, one involves graph traversal, and the other doesn’t.
You can use <code>findMixedTypesEntities</code> and <code>findMixedTypesRelationships</code> for queries that return a mixture of different types of entities or relationships.
As these methods return a list of <a href="https://github.com/linkedin/rest.li/blob/master/data/src/main/java/com/linkedin/data/template/RecordTemplate.java" target="_blank" rel="noopener noreferrer">RecordTemplate</a>, callers will need to manually cast them back to the specific entity type using <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#isInstance-java.lang.Object-" target="_blank" rel="noopener noreferrer">isInstance()</a> or reflection.</p><p>Note that the generics (ENTITY, RELATIONSHIP) are purposely left untyped, as these types are native to the underlying graph DB and will most likely differ from one implementation to another.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class BaseQueryDAO&lt;ENTITY, RELATIONSHIP&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;ENTITY extends RecordTemplate&gt; List&lt;ENTITY&gt; findEntities(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Class&lt;ENTITY&gt; type, Filter filter, int offset, int count);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;ENTITY extends RecordTemplate&gt; List&lt;ENTITY&gt; findEntities(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Class&lt;ENTITY&gt; type, Statement function);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract List&lt;RecordTemplate&gt; findMixedTypesEntities(Statement function);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;ENTITY extends RecordTemplate, RELATIONSHIP extends RecordTemplate&gt; List&lt;RELATIONSHIP&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  findRelationships(Class&lt;ENTITY&gt; entityType, Class&lt;RELATIONSHIP&gt; relationshipType, Filter filter, int offset, int count);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract &lt;RELATIONSHIP extends RecordTemplate&gt; List&lt;RELATIONSHIP&gt; </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  findRelationships(Class&lt;RELATIONSHIP&gt; type, Statement function);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract List&lt;RecordTemplate&gt; findMixedTypesRelationships(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Statement function);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="remote-dao">Remote DAO<a aria-hidden="true" class="hash-link" href="#remote-dao" title="Direct link to heading">​</a></h3><p><a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/BaseRemoteDAO.java" target="_blank" rel="noopener noreferrer">Remote DAO</a> is nothing but a specialized readonly implementation of <a href="https://github.com/linkedin/datahub/blob/master/metadata-dao/src/main/java/com/linkedin/metadata/dao/BaseLocalDAO.java" target="_blank" rel="noopener noreferrer">Local DAO</a>.
Rather than retrieving metadata from a local storage, Remote DAO will fetch the metadata from another <a href="/docs/what/gms">GMS</a>.
The mapping between <a href="/docs/what/entity">entity</a> type and GMS is implemented as a hard-coded map.</p><p>To prevent circular dependency (<a href="https://rest.li" target="_blank" rel="noopener noreferrer">rest.li</a> service depends on remote DAO, which in turn depends on rest.li client generated by each rest.li service),
Remote DAO will need to construct raw rest.li requests directly, instead of using each entity’s rest.li request builder.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="customizing-search-and-graph-index-updates">Customizing Search and Graph Index Updates<a aria-hidden="true" class="hash-link" href="#customizing-search-and-graph-index-updates" title="Direct link to heading">​</a></h2><p>In addition to storing and querying metadata, a common requirement is to customize and extend the fields that are being stored in the search or the graph index. </p><p>As described in <a href="/docs/metadata-modeling/metadata-model">Metadata Modelling</a> section, <a href="/docs/what/entity">Entity</a>, <a href="/docs/what/relationship">Relationship</a>, and <a href="/docs/what/search-document">Search Document</a> models do not directly encode the logic of how each field should be derived from metadata.
Instead, this logic needs to be provided in the form of a Java class: a graph or search index builder.</p><p>The builders register the <a href="/docs/what/aspect">metadata aspect</a>s of their interest against <a href="#mae-consumer-job">MAE Consumer Job</a> and will be invoked whenever a MAE involving the corresponding aspect is received.
If the MAE itself doesn’t contain all the metadata needed, builders can use Remote DAO to fetch from GMS directly.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public abstract class BaseIndexBuilder&lt;DOCUMENT extends RecordTemplate&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> BaseIndexBuilder(@Nonnull List&lt;Class&lt;? extends RecordTemplate&gt;&gt; snapshotsInterested);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> @Nullable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract List&lt;DOCUMENT&gt; getDocumentsToUpdate(@Nonnull RecordTemplate snapshot);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> @Nonnull</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> public abstract Class&lt;DOCUMENT&gt; getDocumentType();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">public interface GraphBuilder&lt;SNAPSHOT extends RecordTemplate&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> GraphUpdates build(SNAPSHOT snapshot);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> @Value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> class GraphUpdates {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   List&lt;? extends RecordTemplate&gt; entities;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   List&lt;RelationshipUpdates&gt; relationshipUpdates;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> @Value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> class RelationshipUpdates {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   List&lt;? extends RecordTemplate&gt; relationships;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   BaseGraphWriterDAO.RemovalOption preUpdateOperation;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/linkedin/datahub/blob/master/docs/how/build-metadata-service.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#using-daos-to-store-and-query-metadata" class="table-of-contents__link toc-highlight">Using DAOs to store and query Metadata</a><ul><li><a href="#key-value-dao-local-dao" class="table-of-contents__link toc-highlight">Key-value DAO (Local DAO)</a></li><li><a href="#search-dao" class="table-of-contents__link toc-highlight">Search DAO</a></li><li><a href="#query-dao" class="table-of-contents__link toc-highlight">Query DAO</a></li><li><a href="#remote-dao" class="table-of-contents__link toc-highlight">Remote DAO</a></li></ul></li><li><a href="#customizing-search-and-graph-index-updates" class="table-of-contents__link toc-highlight">Customizing Search and Graph Index Updates</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/quickstart">Quickstart</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/features">Features</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/faq">FAQs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://slack.datahubproject.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC3qFQC5IiwR5fvWEqi_tJ5w" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.datahubproject.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/townhalls">Town Halls</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/#adoption">Adoption</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/demo">Demo</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/roadmap">Roadmap</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contributing">Contributing</a></li><li class="footer__item"><a href="https://github.com/linkedin/datahub" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://feature-requests.datahubproject.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Feature Requests<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2015-2021 DataHub Project Authors.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9cd1f951.js"></script>
<script src="/assets/js/main.0198f1b5.js"></script>
</body>
</html>